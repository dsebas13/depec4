{% extends 'layout.html' %}

{% block body %}

<div class="row" >
    <div class="col md-7">
        {% with messages = get_flashed_messages() %}
        {% if messages %}
        {% for message in messages %}

        <div class="alert alert-success alert-dismissible fade show" role="alert">
            {{message}}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}
        <form action="/buscar/{{id}}" method="POST">
            <div class="card text-black bg-white mb-2" style="display: block;" data-toggle="collapse">
                <div class="card-body">
                    {% if id == 'A' %}
                    <h5>Búsqueda de CV por atributos</h5>
                    <div class="row">
                        <div class="col-sm-2">
                            Estudios
                            <br>
                            <div class="col-sm-12" style="border: 1px solid rgb(211, 206, 206); border-radius: 12px;">
                                
                                <select name="estudios" id="estudios"
                                    class="selectpicker form-control">
                                    <option value="">Estudios 1</option>
                                    {% for e in atrib %}
                                    {%if e.2 == 'E'%}
                                    <option value="{{ e.0 }}">{{ e.0 }} - {{ e.1 }}</option>
                                    {% endif %}
                                    {% endfor %}
                                </select>
                                
                                <select name="estudios1" id="estudios1"
                                    class="selectpicker form-control">
                                    <option value="">Estudios 2</option>
                                    {% for e in atrib %}
                                    {%if e.2 == 'E'%}
                                    <option value="{{ e.0 }}">{{ e.0 }} - {{ e.1 }}</option>
                                    {% endif %}
                                    {% endfor %}
                                </select>
                                
                                <select name="estudios2" id="estudios2"
                                    class="selectpicker form-control">
                                    <option value="">Estidios 2</option>
                                    {% for e in atrib %}
                                    {%if e.2 == 'E'%}
                                    <option value="{{ e.0 }}">{{ e.0 }} - {{ e.1 }}</option>
                                    {% endif %}
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="col-sm-2">
                            Idioma
                            <div class="col-sm-12" style="border: 1px solid rgb(211, 206, 206); border-radius: 12px;">
                                
                                <select name="idiomas" id="idiomas" onchange="direccion1('idioma1')"
                                    class="selectpicker form-control">
                                    <option value="">Idioma 1</option>
                                    {% for e in atrib %}
                                    {%if e.2 == 'I'%}
                                    <option value="{{ e.0 }}">{{ e.0 }} - {{ e.1 }}</option>
                                    {% endif %}
                                    {% endfor %}
                                </select>
                                
                                <select name="idiomas1" id="idiomas1" onchange="direccion1('idioma1')"
                                    class="selectpicker form-control">
                                    <option value="">Idioma 2</option>
                                    {% for e in atrib %}
                                    {%if e.2 == 'I'%}
                                    <option value="{{ e.0 }}">{{ e.0 }} - {{ e.1 }}</option>
                                    {% endif %}
                                    {% endfor %}
                                </select>
                                
                                <select name="idiomas2" id="idiomas2" onchange="direccion1('idioma1')"
                                    class="selectpicker form-control">
                                    <option value="">Idioma 2</option>
                                    {% for e in atrib %}
                                    {%if e.2 == 'I'%}
                                    <option value="{{ e.0 }}">{{ e.0 }} - {{ e.1 }}</option>
                                    {% endif %}
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            Conocimientos Tecnicos
                            <br>
                            <div class="col-sm-12" style="border: 1px solid rgb(211, 206, 206); border-radius: 12px;">
                                
                                <select name="tecnicas" id="tecnicas" onchange="direccion1('iddireccion1')"
                                    class="selectpicker form-control">
                                    <option value="">Herramientas Tecnicas 1</option>
                                    {% for e in atrib %}
                                    {%if e.2 == 'T'%}
                                    <option value="{{ e.0 }}">{{ e.0 }} - {{ e.1 }}</option>
                                    {% endif %}
                                    {% endfor %}
                                </select>
                                
                                <select name="tecnicas1" id="tecnicas1" onchange="direccion1('iddireccion1')"
                                    class="selectpicker form-control">
                                    <option value="">Herramientas Tecnicas 2</option>
                                    {% for e in atrib %}
                                    {%if e.2 == 'T'%}
                                    <option value="{{ e.0 }}">{{ e.0 }} - {{ e.1 }}</option>
                                    {% endif %}
                                    {% endfor %}
                                </select>
                                
                                <select name="tecnicas2" id="tecnicas2" onchange="direccion1('iddireccion1')"
                                    class="selectpicker form-control">
                                    <option value="">Herramientas Tecnicas 3</option>
                                    {% for e in atrib %}
                                    {%if e.2 == 'T'%}
                                    <option value="{{ e.0 }}">{{ e.0 }} - {{ e.1 }}</option>
                                    {% endif %}
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-2">
                            Estudios
                            <br>
                            <div class="col-sm-12" style="border: 1px solid rgb(211, 206, 206); border-radius: 12px;">
                                <div class="form-check">
                                    {% for a in dataA %}
                                         
                                    <input name="formcheck" class="form-check-input" type="checkbox" value="{{a.0}}"
                                        id="{{a.0}}">
                                    
                                    <label class="form-check-label" for="{{a.0}}">
                                        {{a.0}} - {{a.2}}
                                    </label>
                                    </p>
                                    {% endfor %}
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <h5>Búsqueda de CV por palabras contenidas en archivo PDF</h5>
                    <br>
                    <div class="row">
                        <div class="col-sm-2">
                            <label for="text1">Palabra 1</label>
                            <input type="text" name="text1" class="form-control" required>
                        </div>
                        <div class="col-sm-2">
                            <label for="text2">Palabra 2</label>
                            <input type="text" name="text2" class="form-control">
                        </div>
                        <div class="col-sm-2">
                            <label for="text3">Palabra 3</label>
                            <input type="text" name="text3" class="form-control">
                        </div>
                        <div class="col-sm-2">
                            <label for="text4">Palabra 4</label>
                            <input type="text" name="text4" class="form-control">
                        </div>
                        <div class="col-sm-2">
                            <label for="text5">Palabra 5</label>
                            <input type="text" name="text5" class="form-control">
                        </div>
                    </div>
                    {% endif %}
                    <a rigth style="float: right; border-radius: 22px; margin-left: 30px;margin-top: -30px;" class="btn" href="/buscar/{{id}}"><i
                            class="fas fa-eraser" data-bs-toggle="tooltip" data-bs-placement="top"
                            title="Borrar filtros"></i></a>

                    <button type="submit" class="btn" rigth
                        style="float: right; background-color: #8fed8f; color: white; margin-top: -30px;border-radius: 22px;">
                        <i class="fas fa-search" data-bs-toggle="tooltip" data-bs-placement="top" title="Buscar"></i>
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>
{% if session['rol'] == 1 %}
{% if buscar != 0 %}
<hr>
<div class="row" style="margin-bottom: 100px;">
    <div class="col md-7">
        <table id="myTable2" class="table table-striped table-bordered bg-white table-sm">
            <h2>Listado de CV's ingresados</h2>
            <thead>
                <tr>
                    <td style="width: 6.7%;" onclick="sortTable(0)">Dni<i right style="float: right; margin-top: 3px;"
                            class="fas fa-sort"></i></td>
                    <td style="width: 7.4%; " onclick="sortTable(1)">Apellido <i right
                            style="float: right;  margin-top: 3px;" class="fas fa-sort"></i></td>
                    <td style="width: 6.7%;">Nombre</td>
                    <td style="width: 8.2%;">Telefono</td>
                    <td style="width: 21.2%;">Email</td>
                    <td style="width: 30%;" onclick="sortTable(2)">Dirección<i right
                            style="float: right;  margin-top: 3px;" class="fas fa-sort"></i></td>
                    <td onclick="sortTable(3)">Actualizado<i right style="float: right; margin-top: 3px;"
                            class="fas fa-sort"></i></td>
                    <td>Operaciones</td>
                </tr>
            </thead>
            <tbody>
                {% for c in buscar %}
                <tr>
                    <td> {{ c.0 }} </td>
                    <td> {{ c.1.capitalize() }} </td>
                    <td> {{ c.2.capitalize() }} </td>
                    <td> {{ c.3 }} </td>
                    <td> {{ c.4 }} </td>
                    <td> {{ c.5 }} </td>
                    <td> {{ c.6.strftime('%d-%m-%Y') }} </td>
                    <td style="text-align: center; vertical-align: middle;">
                        <a href="/viewcv/{{c.7}}" class="btn btn-sm"
                            style="background-color: lightblue; border-radius: 12px; margin-right: 30px; "><i
                                class="fas fa-eye" data-bs-toggle="tooltip" data-bs-placement="top" title="Ver"></i></a>
                        &nbsp;
                        &nbsp;
                        <form action="/bajarcv" target="_blank" method="POST">
                            <input type="hidden" name="b64" id="b64" value="{{c.8}}">
                            <input type="hidden" name="nameuser" id="nameuser" value="{{c.1}} {{c.2}}">
                            <button type="submit" class="btn btn-sm"
                                style="background-color: lightblue; border-radius: 12px; margin-top: -47px; margin-left: 50px; "><i
                                    class="fas fa-download" data-bs-toggle="tooltip" data-bs-placement="top"
                                    title="Descargar CV"></i></a>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}
{% endif %}

<script>
    function sortTable(n) {
        var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
        table = document.getElementById("myTable2");
        switching = true;
        // Set the sorting direction to ascending:
        dir = "asc";
        /* Make a loop that will continue until
        no switching has been done: */
        while (switching) {
            // Start by saying: no switching is done:
            switching = false;
            rows = table.rows;
            /* Loop through all table rows (except the
            first, which contains table headers): */
            for (i = 1; i < (rows.length - 1); i++) {
                // Start by saying there should be no switching:
                shouldSwitch = false;
                /* Get the two elements you want to compare,
                one from current row and one from the next: */
                x = rows[i].getElementsByTagName("TD")[n];
                y = rows[i + 1].getElementsByTagName("TD")[n];
                /* Check if the two rows should switch place,
                based on the direction, asc or desc: */
                if (dir == "asc") {
                    if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                        // If so, mark as a switch and break the loop:
                        shouldSwitch = true;
                        break;
                    }
                } else if (dir == "desc") {
                    if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                        // If so, mark as a switch and break the loop:
                        shouldSwitch = true;
                        break;
                    }
                }
            }
            if (shouldSwitch) {
                /* If a switch has been marked, make the switch
                and mark that a switch has been done: */
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
                // Each time a switch is done, increase this count by 1:
                switchcount++;
            } else {
                /* If no switching has been done AND the direction is "asc",
                set the direction to "desc" and run the while loop again. */
                if (switchcount == 0 && dir == "asc") {
                    dir = "desc";
                    switching = true;
                }
            }
        }
    }
</script>







{% endblock%}